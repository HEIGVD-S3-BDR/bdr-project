{% extends "base.html" %}

{% block content %}
<h1>Candidats</h1>

<script>
  // Function to submit the form while preserving existing query parameters
  function submitForm() {
    const form = document.getElementById('filterForm');
    const urlParams = new URLSearchParams(window.location.search);

    // Get all checkboxes in the form
    const checkboxes = document.querySelectorAll('.gender-filter input[type="checkbox"]');

    // Clear existing 'gender' parameters
    urlParams.delete('gender');

    // Add checked checkboxes to the 'gender' parameter
    checkboxes.forEach(function(checkbox) {
      if (checkbox.checked) {
        urlParams.append('gender', checkbox.value);
      }
    });

    // Update age filters
    const minAge = document.getElementById('minAge').value;
    const maxAge = document.getElementById('maxAge').value;
    if (minAge) {
      urlParams.set('minAge', minAge);
    } else {
      urlParams.delete('minAge');
    }
    if (maxAge) {
      urlParams.set('maxAge', maxAge);
    } else {
      urlParams.delete('maxAge');
    }

    // Construct the new URL
    const newUrl = window.location.pathname + '?' + urlParams.toString();
    window.location = newUrl; // Navigate to the new URL
  };
</script>

<div class="filter-box">
  <label>Filtres</label>

  <form method="get" action="/candidats" id="filterForm">
    <div class="filter-item gender-filter">
      <label for="gender">Genres</label>
      <input type="checkbox" name="gender" value="Homme" {% if "Homme" in gender %}checked{% endif %} id="genderHomme" onchange="submitForm()"> Homme<br>
      <input type="checkbox" name="gender" value="Femme" {% if "Femme" in gender %}checked{% endif %} id="genderFemme" onchange="submitForm()"> Femme<br>  
      <input type="checkbox" name="gender" value="Autre" {% if "Autre" in gender %}checked{% endif %} id="genderAutre" onchange="submitForm()"> Autre
    </div>

    <div class="filter-box item">
      <label for="Age">Age:</label>
      <div class="filter-item">
        <label for="minAge">Min Age:</label>
        <input type="number" id="minAge" name="minAge" value="{{ minAge or '' }}" min="0" 
              onchange="submitForm()" onblur="submitForm()">
      </div>

      <div class="filter-item">
        <label for="maxAge">Max Age:</label>
        <input type="number" id="maxAge" name="maxAge" value="{{ maxAge or '' }}" min="0" 
              onchange="submitForm()" onblur="submitForm()">
      </div>  
    </div>

    <div class="filter-box item">
      <label for="Age">Expérience:</label>
      <div class="filter-item">
        <label for="minExp">Min Exp:</label>
        <input type="number" id="minExp" name="minExp" value="{{ minExp or '' }}" min="0" 
              onchange="submitForm()" onblur="submitForm()">
      </div>

      <div class="filter-item">
        <label for="maxExp">Max Exp:</label>
        <input type="number" id="maxExp" name="maxExp" value="{{ maxExp or '' }}" min="0" 
              onchange="submitForm()" onblur="submitForm()">
      </div>  
    </div>

  <noscript><button type="submit">Appliquer</button></noscript>
  </form>
</div>


<figure>
  <table>
    <thead>
      <tr>
        <th>ID</th>
        <th>Nom</th>
        <th>Prénom</th>
        <th>Email</th>
        <th>Âge</th>
        <th>Genre</th>
        <th>Numéro de téléphone</th>
        <th>Années d'expérience</th>
        <th>Actions</th>
      </tr>
    </thead>
    <tbody>
      {% for candidat in candidats %}
      <tr>
        <td>{{ candidat.id }}</td>
        <td>{{ candidat.nom }}</td>
        <td>{{ candidat.prenom }}</td>
        <td>{{ candidat.email }}</td>
        <td>{{ candidat.age }}</td>
        <td>{{ candidat.genre }}</td>
        <td>{{ candidat.numerotel }}</td>
        <td>{{ candidat.anneesexp }}</td>
        <td>
          <a href="/candidats/{{ candidat.id }}">
            Détails
          </a>
          <a href="/candidat/{{ candidat.id }}/edit">
            Modifier
          </a>
        </td>
      </tr>
      {% endfor %}
    </tbody>
  </table>
</figure>
{% endblock %}
