{% extends "base.html" %}

{% block content %}
<h1>Offres</h1>

<script>
  function submitForm() {
    const form = document.getElementById("filterForm");
    const urlParams = new URLSearchParams(window.location.search);
    const statut = document.getElementById("statut").value;
    urlParams.set("statut", statut);
    const newUrl = "/offres?" + urlParams.toString();  
    window.location = newUrl; 
  }
</script>

<div class="filter-box">
  <label>Filtres</label>
  
<form method="get" action="/offres" id="filterForm">
  <div class="filter-item">
  <select name="statut" id="statut" onchange="submitForm()">
    <option value="all" {% if statut == "all" %}selected{% endif %}>Toutes les offres</option>
    <option value="open" {% if statut == "open" %}selected{% endif %}>Offres ouvertes uniquement</option>
    <option value="closed" {% if statut == "closed" %}selected{% endif %}>Offres closes uniquement</option>
  </select>
  </div>

  <noscript><button type="submit">Appliquer</button></noscript>
</form>

</div>

<figure>
  <table>
    <thead>
      <tr>
        <th>ID</th>
        <th>Poste</th>
        <th>Années d'expérience requises</th>
        <th>Date de publication</th>
        <th>Date de clôture</th>
        <th>Actions</th>
      </tr>
    </thead>
    <tbody>
      {% for offre in offres %}
      <tr>
        <td>{{ offre.id }}</td>
        <td>{{ offre.nomposte }}</td>
        <td>{{ offre.anneesexprequises }}</td>
        <td>{{ offre.datepublication }}</td>
        <td>{{ offre.datecloture|default('-', true) }}</td>
        <td>
          {% if offre.datecloture == None %}
            <form action="/offres/{{ offre.id }}/close" method="post">
              <button type="submit" class="destructive">
                Clôturer
              </button>
            </form>
          {% endif %}
          <a href="/offres/{{ offre.id }}">
            Détails
          </a>
          <a href="/offre/{{ offre.id }}/edit">
            Modifier
          </a>
        </td>
      </tr>
      {% endfor %}
    </tbody>
  </table>
</figure>
{% endblock %}